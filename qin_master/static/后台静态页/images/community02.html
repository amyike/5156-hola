<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>亲邻网管理后台</title>
<link href="../style.css" rel="stylesheet" type="text/css">
<link href="index_data/box.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="index_data/common.js"></script>
<script type="text/javascript" src="index_data/box.js"></script>
</head>
<body>
<div class="so_main">
  <div class="page_tit">用户组管理</div>
  <div class="Toolbar_inbox">
  	<div class="page right"></div>
  	<a href="javascript:void(0);" class="btn_a" onClick="add();"><span>添加用户组</span></a>
	<a href="javascript:void(0);" class="btn_a" onClick="del();"><span>删除用户组</span></a>
  </div>
  
  <div class="list">
  <table id="user_group_list" border="0" cellpadding="0" cellspacing="0" width="100%">
  <tbody><tr>
    <th style="width: 30px;">
		<input id="checkbox_handle" onClick="checkAll(this)" value="0" type="checkbox">
    	<label for="checkbox"></label>
	</th>
    <th class="line_l">ID</th>
    <th class="line_l">用户组名称</th>
    <th class="line_l">用户组图标</th>
    <th class="line_l">创建时间</th>
    <th class="line_l">操作</th>
  </tr>
  <tr class="" overstyle="on" id="group_1">
	    <td><input name="checkbox" id="checkbox2" onClick="checkon(this)" value="1" type="checkbox"></td>
	    <td>1</td>
	    <td>
			<div id="user_group_name_1" style="float:left">管理员</div>
		</td>
		<td id="user_group_icon_1"> <img src="index_data/v_05.gif"> </td>
	    <td>2010-12-01 00:59</td>
	    <td>
			<a href="javascript:void(0);" onClick="edit(1);">编辑</a> 
	    	<a href="javascript:void(0);" onClick="del(1);">删除</a>  
		</td>
	  </tr><tr class="" overstyle="on" id="group_2">
	    <td><input name="checkbox" id="checkbox2" onClick="checkon(this)" value="2" type="checkbox"></td>
	    <td>2</td>
	    <td>
			<div id="user_group_name_2" style="float:left">商家用户</div>
		</td>
		<td id="user_group_icon_2">&nbsp; </td>
	    <td>2011-10-16 20:50</td>
	    <td>
			<a href="javascript:void(0);" onClick="edit(2);">编辑</a> 
	    	<a href="javascript:void(0);" onClick="del(2);">删除</a>  
		</td>
	  </tr><tr overstyle="on" id="group_3">
	    <td><input name="checkbox" id="checkbox2" onClick="checkon(this)" value="3" type="checkbox"></td>
	    <td>3</td>
	    <td>
			<div id="user_group_name_3" style="float:left">小区物业</div>
		</td>
		<td id="user_group_icon_3">&nbsp; </td>
	    <td>2011-10-16 20:50</td>
	    <td>
			<a href="javascript:void(0);" onClick="edit(3);">编辑</a> 
	    	<a href="javascript:void(0);" onClick="del(3);">删除</a>  
		</td>
	  </tr><tr overstyle="on" id="group_4">
	    <td><input name="checkbox" id="checkbox2" onClick="checkon(this)" value="4" type="checkbox"></td>
	    <td>4</td>
	    <td>
			<div id="user_group_name_4" style="float:left">亲邻会员</div>
		</td>
		<td id="user_group_icon_4">&nbsp; </td>
	    <td>2011-10-16 22:03</td>
	    <td>
			<a href="javascript:void(0);" onClick="edit(4);">编辑</a> 
	    	<a href="javascript:void(0);" onClick="del(4);">删除</a>  
		</td>
	  </tr>  </tbody></table>

  </div>
  <div class="Toolbar_inbox">
	<div class="page right"></div>
  	<a href="javascript:void(0);" class="btn_a" onClick="add();"><span>添加用户组</span></a>
	<a href="javascript:void(0);" class="btn_a" onClick="del();"><span>删除用户组</span></a>
  </div>
</div>

<script>
	//鼠标移动表格效果
	$(document).ready(function(){
		$("tr[overstyle='on']").hover(
		  function () {
		    $(this).addClass("bg_hover");
		  },
		  function () {
		    $(this).removeClass("bg_hover");
		  }
		);
	});
	
	function checkon(o){
		if( o.checked == true ){
			$(o).parents('tr').addClass('bg_on') ;
		}else{
			$(o).parents('tr').removeClass('bg_on') ;
		}
	}
	
	function checkAll(o){
		if( o.checked == true ){
			$('input[name="checkbox"]').attr('checked','true');
			$('tr[overstyle="on"]').addClass("bg_on");
		}else{
			$('input[name="checkbox"]').removeAttr('checked');
			$('tr[overstyle="on"]').removeClass("bg_on");
		}
	}

	//获取已选择用户的ID数组
	function getChecked() {
		var gids = new Array();
		$.each($('input:checked'), function(i, n){
			gids.push( $(n).val() );
		});
		return gids;
	}

	//添加用户组
	function add() {
		ui.box.load("http://211.155.227.148:6688/index.php?app=admin&mod=User&act=editUserGroup", {title:'添加用户组'});
	}
	
	//编辑用户组
	function edit(gid) {
		ui.box.load("http://211.155.227.148:6688/index.php?app=admin&mod=User&act=editUserGroup&gid="+gid, {title:'编辑用户组'});
	}
	
	//删除用户组
	function del(gid) {
		gid = gid ? gid : getChecked();
		gid = gid.toString();
		if(gid == '') return false;

		//检查用户组是否为空
		$.post("http://211.155.227.148:6688/index.php?app=admin&mod=User&act=isUserGroupEmpty", {gid:gid}, function(res){
			if(res == '0') {
				ui.error('所选的用户组不为空，不允许删除');
				return false;
			}
			
			//用户确认删除
			if(!confirm('删除成功后将无法恢复，确认继续？')) return false;
			
			//提交删除
			$.post("http://211.155.227.148:6688/index.php?app=admin&mod=User&act=doDeleteUserGroup", {gid:gid}, function(res){
			if(res == '1') {
				gid = gid.split(',');
				$.each(gid, function(i,n){
					$('#group_'+n).remove();
				});
				
				ui.success('删除成功');
			}else {
				ui.error('删除失败');
			}
		});
		});
		
		
	}
</script>


</body></html>